<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="4730.491002275328" height="5979.042525718504"><desc>sequenceDiagram%0A%20%20%20%20actor%20Customer%0A%20%20%20%20participant%20Frontend%20as%20Frontend%20App%0A%20%20%20%20participant%20API%20as%20Express%20API%0A%20%20%20%20participant%20Controller%20as%20PaymentController%0A%20%20%20%20participant%20Service%20as%20PaymentService%0A%20%20%20%20participant%20Stripe%20as%20Stripe%20API%0A%20%20%20%20participant%20Prisma%20as%20Prisma%20ORM%0A%20%20%20%20participant%20DB%20as%20PostgreSQL%0A%20%20%20%20participant%20Webhook%20as%20Webhook%20Handler%0A%0A%20%20%20%20rect%20rgb(200%2C%20220%2C%20250)%0A%20%20%20%20Note%20over%20Customer%2CDB%3A%20%C3%89TAPE%201%3A%20Cr%C3%A9ation%20PaymentIntent%0A%20%20%20%20Customer-%3E%3EFrontend%3A%20Click%20%22Payer%22%0A%20%20%20%20Frontend-%3E%3EAPI%3A%20POST%20%2Fapi%2Fpayments%2Fcreate-intent%0A%20%20%20%20Note%20over%20Frontend%2CAPI%3A%20Body%3A%20%7B%20order_id%3A%20123%20%7D%0A%20%20%20%20%0A%20%20%20%20API-%3E%3EController%3A%20createPaymentIntent(req%2C%20res)%0A%20%20%20%20Controller-%3E%3EService%3A%20createIntent(orderId%2C%20userId)%0A%20%20%20%20%0A%20%20%20%20Service-%3E%3EPrisma%3A%20prisma.order.findUnique(%7B%20where%3A%20%7B%20id%2C%20customer_id%20%7D%20%7D)%0A%20%20%20%20Prisma-%3E%3EDB%3A%20SELECT%20*%20FROM%20orders%20WHERE%20id%20%3D%20%3F%20AND%20customer_id%20%3D%20%3F%0A%20%20%20%20%0A%20%20%20%20alt%20Commande%20non%20trouv%C3%A9e%20ou%20non%20autoris%C3%A9e%0A%20%20%20%20%20%20%20%20DB--%3E%3EPrisma%3A%20null%0A%20%20%20%20%20%20%20%20Prisma--%3E%3EService%3A%20null%0A%20%20%20%20%20%20%20%20Service--%3E%3EController%3A%20OrderNotFoundError%0A%20%20%20%20%20%20%20%20Controller--%3E%3EFrontend%3A%20404%20Not%20Found%0A%20%20%20%20else%20Commande%20valide%0A%20%20%20%20%20%20%20%20DB--%3E%3EPrisma%3A%20Order%20data%0A%20%20%20%20%20%20%20%20Prisma--%3E%3EService%3A%20Order%20object%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20Service-%3E%3EService%3A%20validateOrderCanBePaid(order)%0A%20%20%20%20%20%20%20%20Note%20over%20Service%3A%20V%C3%A9rifie%3A%20status%20%3D%20PENDING%2C%20non%20pay%C3%A9e%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20alt%20D%C3%A9j%C3%A0%20pay%C3%A9e%20ou%20invalide%0A%20%20%20%20%20%20%20%20%20%20%20%20Service--%3E%3EController%3A%20OrderInvalidStateError%0A%20%20%20%20%20%20%20%20%20%20%20%20Controller--%3E%3EFrontend%3A%20400%20Bad%20Request%0A%20%20%20%20%20%20%20%20else%20OK%20pour%20paiement%0A%20%20%20%20%20%20%20%20%20%20%20%20Service-%3E%3EStripe%3A%20stripe.paymentIntents.create(%7B...%7D)%0A%20%20%20%20%20%20%20%20%20%20%20%20Note%20over%20Service%2CStripe%3A%20amount%3A%2012999%20(129.99%E2%82%AC%20en%20centimes)%3Cbr%2F%3Ecurrency%3A%20'eur'%3Cbr%2F%3Emetadata%3A%20%7B%20order_id%3A%20123%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20Stripe--%3E%3EService%3A%20PaymentIntent%20%7B%20id%2C%20client_secret%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20Service-%3E%3EPrisma%3A%20prisma.payment.create(%7B%20data%3A%20%7B...%7D%20%7D)%0A%20%20%20%20%20%20%20%20%20%20%20%20Prisma-%3E%3EDB%3A%20INSERT%20INTO%20payments%20(order_id%2C%20stripe_intent_id%2C%20amount%2C%20status)%0A%20%20%20%20%20%20%20%20%20%20%20%20DB--%3E%3EPrisma%3A%20Payment%20created%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20Service--%3E%3EController%3A%20%7B%20client_secret%2C%20payment_id%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20Controller--%3E%3EFrontend%3A%20200%20OK%20%2B%20%7B%20client_secret%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20Frontend-%3E%3EFrontend%3A%20stripe.confirmCardPayment(clientSecret%2C%20%7Bcard%7D)%0A%20%20%20%20%20%20%20%20%20%20%20%20Note%20over%20Frontend%3A%20Affiche%20formulaire%20Stripe%20Elements%0A%20%20%20%20%20%20%20%20end%0A%20%20%20%20end%0A%20%20%20%20end%0A%0A%20%20%20%20rect%20rgb(250%2C%20220%2C%20200)%0A%20%20%20%20Note%20over%20Customer%2CStripe%3A%20%C3%89TAPE%202%3A%20Customer%20saisit%20carte%0A%20%20%20%20Customer-%3E%3EFrontend%3A%20Saisit%20num%C3%A9ro%20carte%0A%20%20%20%20Frontend-%3E%3EStripe%3A%20confirmCardPayment(client_secret%2C%20payment_method)%0A%20%20%20%20Note%20over%20Stripe%3A%20Traitement%20s%C3%A9curis%C3%A9%20c%C3%B4t%C3%A9%20Stripe%0A%20%20%20%20%0A%20%20%20%20alt%20Carte%20refus%C3%A9e%0A%20%20%20%20%20%20%20%20Stripe--%3E%3EFrontend%3A%20Error%20%7B%20code%3A%20'card_declined'%20%7D%0A%20%20%20%20%20%20%20%20Frontend--%3E%3ECustomer%3A%20Message%20d'erreur%0A%20%20%20%20else%20Paiement%20r%C3%A9ussi%0A%20%20%20%20%20%20%20%20Stripe--%3E%3EFrontend%3A%20PaymentIntent%20%7B%20status%3A%20'succeeded'%20%7D%0A%20%20%20%20%20%20%20%20Frontend--%3E%3ECustomer%3A%20%22Paiement%20en%20cours...%22%0A%20%20%20%20end%0A%20%20%20%20end%0A%0A%20%20%20%20rect%20rgb(220%2C%20250%2C%20220)%0A%20%20%20%20Note%20over%20Webhook%2CDB%3A%20%C3%89TAPE%203%3A%20Webhook%20Stripe%20(Asynchrone)%0A%20%20%20%20Stripe-%3E%3EWebhook%3A%20POST%20%2Fapi%2Fwebhooks%2Fstripe%0A%20%20%20%20Note%20over%20Stripe%2CWebhook%3A%20Event%3A%20payment_intent.succeeded%3Cbr%2F%3ESignature%3A%20stripe-signature%20header%0A%20%20%20%20%0A%20%20%20%20Webhook-%3E%3EWebhook%3A%20verifyWebhookSignature(req)%0A%20%20%20%20%0A%20%20%20%20alt%20Signature%20invalide%0A%20%20%20%20%20%20%20%20Webhook--%3E%3EStripe%3A%20400%20Bad%20Request%0A%20%20%20%20else%20Signature%20valide%0A%20%20%20%20%20%20%20%20Webhook-%3E%3EWebhook%3A%20extractEventData(event)%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20alt%20Event%20type%3A%20payment_intent.succeeded%0A%20%20%20%20%20%20%20%20%20%20%20%20Webhook-%3E%3EService%3A%20handlePaymentSuccess(paymentIntentId)%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20Service-%3E%3EPrisma%3A%20prisma.payment.findUnique(%7B%20where%3A%20%7B%20stripe_intent_id%20%7D%20%7D)%0A%20%20%20%20%20%20%20%20%20%20%20%20Prisma-%3E%3EDB%3A%20SELECT%20*%20FROM%20payments%20WHERE%20stripe_intent_id%20%3D%20%3F%0A%20%20%20%20%20%20%20%20%20%20%20%20DB--%3E%3EPrisma%3A%20Payment%20data%0A%20%20%20%20%20%20%20%20%20%20%20%20Prisma--%3E%3EService%3A%20Payment%20object%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20Service-%3E%3EPrisma%3A%20prisma.%24transaction(%5B...%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20Note%20over%20Prisma%2CDB%3A%20Transaction%20START%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20Prisma-%3E%3EDB%3A%20UPDATE%20payments%20SET%20status%20%3D%20'COMPLETED'%2C%20paid_at%20%3D%20NOW()%0A%20%20%20%20%20%20%20%20%20%20%20%20Prisma-%3E%3EDB%3A%20UPDATE%20orders%20SET%20status%20%3D%20'PROCESSING'%2C%20payment_status%20%3D%20'PAID'%0A%20%20%20%20%20%20%20%20%20%20%20%20Prisma-%3E%3EDB%3A%20UPDATE%20customers%20SET%20last_purchase_date%20%3D%20NOW()%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20Note%20over%20Prisma%2CDB%3A%20Transaction%20COMMIT%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20Service-%3E%3EService%3A%20sendConfirmationEmail(order)%0A%20%20%20%20%20%20%20%20%20%20%20%20Service-%3E%3EService%3A%20createInvoice(order)%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20Service--%3E%3EWebhook%3A%20Success%0A%20%20%20%20%20%20%20%20%20%20%20%20Webhook--%3E%3EStripe%3A%20200%20OK%0A%20%20%20%20%20%20%20%20else%20Event%20type%3A%20payment_intent.payment_failed%0A%20%20%20%20%20%20%20%20%20%20%20%20Webhook-%3E%3EService%3A%20handlePaymentFailure(paymentIntentId)%0A%20%20%20%20%20%20%20%20%20%20%20%20Service-%3E%3EPrisma%3A%20prisma.payment.update(%7B%20where%3A%20%7B...%7D%2C%20data%3A%20%7B%20status%3A%20'FAILED'%20%7D%20%7D)%0A%20%20%20%20%20%20%20%20%20%20%20%20Prisma-%3E%3EDB%3A%20UPDATE%20payments%20SET%20status%20%3D%20'FAILED'%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20Service-%3E%3EService%3A%20notifyCustomerOfFailure(order)%0A%20%20%20%20%20%20%20%20%20%20%20%20Service--%3E%3EWebhook%3A%20Success%0A%20%20%20%20%20%20%20%20%20%20%20%20Webhook--%3E%3EStripe%3A%20200%20OK%0A%20%20%20%20%20%20%20%20end%0A%20%20%20%20end%0A%20%20%20%20end%0A%0A%20%20%20%20rect%20rgb(250%2C%20250%2C%20200)%0A%20%20%20%20Note%20over%20Customer%2CDB%3A%20%C3%89TAPE%204%3A%20V%C3%A9rification%20Frontend%0A%20%20%20%20Frontend-%3E%3EAPI%3A%20GET%20%2Fapi%2Forders%2F123%2Fpayment-status%0A%20%20%20%20API-%3E%3EController%3A%20getPaymentStatus(req%2C%20res)%0A%20%20%20%20Controller-%3E%3EService%3A%20getOrderPaymentStatus(orderId)%0A%20%20%20%20%0A%20%20%20%20Service-%3E%3EPrisma%3A%20prisma.order.findUnique(%7B%20where%3A%20%7B%20id%20%7D%2C%20include%3A%20%7B%20payment%20%7D%20%7D)%0A%20%20%20%20Prisma-%3E%3EDB%3A%20SELECT%20*%20FROM%20orders%20o%20JOIN%20payments%20p%20WHERE%20o.id%20%3D%20%3F%0A%20%20%20%20DB--%3E%3EPrisma%3A%20Order%20with%20payment%0A%20%20%20%20Prisma--%3E%3EService%3A%20Order%20data%0A%20%20%20%20%0A%20%20%20%20Service--%3E%3EController%3A%20Payment%20status%0A%20%20%20%20Controller--%3E%3EFrontend%3A%20200%20OK%20%2B%20%7B%20status%3A%20'COMPLETED'%20%7D%0A%20%20%20%20Frontend--%3E%3ECustomer%3A%20%22Paiement%20confirm%C3%A9!%20%F0%9F%8E%89%22%0A%20%20%20%20end</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="4730" height="5979"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 118.74436245000001 142.09742039850002 L 118.74436245000001 5979.042525718504" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="20.298181615384618,8.795878700000001"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 291.1032819606875 142.09742039850002 L 291.1032819606875 5979.042525718504" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="20.298181615384618,8.795878700000001"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 524.2795923649727 142.09742039850002 L 524.2795923649727 5979.042525718504" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="20.298181615384618,8.795878700000001"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 776.1781394025586 142.09742039850002 L 776.1781394025586 5979.042525718504" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="20.298181615384618,8.795878700000001"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1053.7423816305743 142.09742039850002 L 1053.7423816305743 5979.042525718504" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="20.298181615384618,8.795878700000001"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1290.9773620788048 142.09742039850002 L 1290.9773620788048 5979.042525718504" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="20.298181615384618,8.795878700000001"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1515.1522381569182 142.09742039850002 L 1515.1522381569182 5979.042525718504" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="20.298181615384618,8.795878700000001"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1737.2906228409886 142.09742039850002 L 1737.2906228409886 5979.042525718504" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="20.298181615384618,8.795878700000001"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1984.0531988092387 142.09742039850002 L 1984.0531988092387 5979.042525718504" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="20.298181615384618,8.795878700000001"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2198.2280977755354 142.09742039850002 L 2198.2280977755354 5979.042525718504" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="20.298181615384618,8.795878700000001"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2557.0275955425277 142.09742039850002 L 2557.0275955425277 5979.042525718504" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="20.298181615384618,8.795878700000001"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2822.133257344676 142.09742039850002 L 2822.133257344676 5979.042525718504" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="20.298181615384618,8.795878700000001"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3105.9790772278793 142.09742039850002 L 3105.9790772278793 5979.042525718504" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="20.298181615384618,8.795878700000001"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3593.468390763426 142.09742039850002 L 3593.468390763426 5979.042525718504" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="20.298181615384618,8.795878700000001"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4130.735795729637 142.09742039850002 L 4130.735795729637 5979.042525718504" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="20.298181615384618,8.795878700000001"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4243.715298272594 142.09742039850002 L 4243.715298272594 5979.042525718504" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="20.298181615384618,8.795878700000001"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4491.712912589391 142.09742039850002 L 4491.712912589391 5979.042525718504" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="20.298181615384618,8.795878700000001"/></g><g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 133.78531502700002 30.477719695500014 A 15.040952577 15.040952577 0 1 1 133.78530750652436 30.46267874542983" stroke-miterlimit="10" stroke-width="4.485898137" stroke-dasharray=""/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 118.74436245000001 45.51867227250001 L 118.74436245000001 77.7115883145 M 99.74526445800001 57.12923215650002 L 137.743460442 57.12923215650002 M 118.74436245000001 77.7115883145 L 99.74526445800001 107.79349346850002 M 118.74436245000001 77.7115883145 L 137.743460442 107.79349346850002" stroke-miterlimit="10" stroke-width="4.485898137"/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="86.97271785771485" y="134.1811295685" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Customer</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 176.90364314228518 70.85080292850002 L 405.30292077908985 70.85080292850002 L 405.30292077908985 142.09742039850002 L 176.90364314228518 142.09742039850002 L 176.90364314228518 70.85080292850002 Z" stroke-miterlimit="10" stroke-width="4.222021776" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="205.53422831078518" y="115.70978429850003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Frontend as Frontend App</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 431.69055687908985 70.85080292850002 L 616.8686278508555 70.85080292850002 L 616.8686278508555 142.09742039850002 L 431.69055687908985 142.09742039850002 L 431.69055687908985 70.85080292850002 Z" stroke-miterlimit="10" stroke-width="4.222021776" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="460.3211420475899" y="115.70978429850003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">API as Express API</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 643.2562639508554 70.85080292850002 L 909.1000148542616 70.85080292850002 L 909.1000148542616 142.09742039850002 L 643.2562639508554 142.09742039850002 L 643.2562639508554 70.85080292850002 Z" stroke-miterlimit="10" stroke-width="4.222021776" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="671.8868491193555" y="115.70978429850003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Controller as PaymentController</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 935.4876509542618 70.85080292850002 L 1171.9971123068867 70.85080292850002 L 1171.9971123068867 142.09742039850002 L 935.4876509542618 142.09742039850002 L 935.4876509542618 70.85080292850002 Z" stroke-miterlimit="10" stroke-width="4.222021776" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="964.1182361227618" y="115.70978429850003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Service as PaymentService</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1198.384748406887 70.85080292850002 L 1383.569975750723 70.85080292850002 L 1383.569975750723 142.09742039850002 L 1198.384748406887 142.09742039850002 L 1198.384748406887 70.85080292850002 Z" stroke-miterlimit="10" stroke-width="4.222021776" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1227.0153335753869" y="115.70978429850003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Stripe as Stripe API</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1409.957611850723 70.85080292850002 L 1620.3468644631137 70.85080292850002 L 1620.3468644631137 142.09742039850002 L 1409.957611850723 142.09742039850002 L 1409.957611850723 70.85080292850002 Z" stroke-miterlimit="10" stroke-width="4.222021776" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1438.588197019223" y="115.70978429850003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Prisma as Prisma ORM</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1646.7345005631137 70.85080292850002 L 1827.8467451188637 70.85080292850002 L 1827.8467451188637 142.09742039850002 L 1646.7345005631137 142.09742039850002 L 1646.7345005631137 70.85080292850002 Z" stroke-miterlimit="10" stroke-width="4.222021776" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1675.3650857316136" y="115.70978429850003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">DB as PostgreSQL</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1854.2343812188637 70.85080292850002 L 2113.8720163996136 70.85080292850002 L 2113.8720163996136 142.09742039850002 L 1854.2343812188637 142.09742039850002 L 1854.2343812188637 70.85080292850002 Z" stroke-miterlimit="10" stroke-width="4.222021776" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1882.8649663873637" y="115.70978429850003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Webhook as Webhook Handler</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 2140.2596524996134 70.85080292850002 L 2256.196543051457 70.85080292850002 L 2256.196543051457 142.09742039850002 L 2140.2596524996134 142.09742039850002 L 2140.2596524996134 70.85080292850002 Z" stroke-miterlimit="10" stroke-width="4.222021776" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2168.8902376681135" y="115.70978429850003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Frontend</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 2516.5824122905315 70.85080292850002 L 2597.4727787945235 70.85080292850002 L 2597.4727787945235 142.09742039850002 L 2516.5824122905315 142.09742039850002 L 2516.5824122905315 70.85080292850002 Z" stroke-miterlimit="10" stroke-width="4.222021776" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2545.2129974590316" y="115.70978429850003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">API</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 2761.7274570272502 70.85080292850002 L 2882.5390576621016 70.85080292850002 L 2882.5390576621016 142.09742039850002 L 2761.7274570272502 142.09742039850002 L 2761.7274570272502 70.85080292850002 Z" stroke-miterlimit="10" stroke-width="4.222021776" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2790.3580421957504" y="115.70978429850003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Controller</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 3052.9068492981487 70.85080292850002 L 3159.0513051576095 70.85080292850002 L 3159.0513051576095 142.09742039850002 L 3052.9068492981487 142.09742039850002 L 3052.9068492981487 70.85080292850002 Z" stroke-miterlimit="10" stroke-width="4.222021776" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3081.537434466649" y="115.70978429850003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Service</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 3542.0318058390667 70.85080292850002 L 3644.9049756877853 70.85080292850002 L 3644.9049756877853 142.09742039850002 L 3542.0318058390667 142.09742039850002 L 3542.0318058390667 70.85080292850002 Z" stroke-miterlimit="10" stroke-width="4.222021776" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3570.662391007567" y="115.70978429850003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Prisma</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 4091.922677296977 70.85080292850002 L 4169.5489141622975 70.85080292850002 L 4169.5489141622975 142.09742039850002 L 4091.922677296977 142.09742039850002 L 4091.922677296977 70.85080292850002 Z" stroke-miterlimit="10" stroke-width="4.222021776" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4120.553262465477" y="115.70978429850003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">DB</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 4195.936550262297 70.85080292850002 L 4291.494046282891 70.85080292850002 L 4291.494046282891 142.09742039850002 L 4195.936550262297 142.09742039850002 L 4195.936550262297 70.85080292850002 Z" stroke-miterlimit="10" stroke-width="4.222021776" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4224.567135430797" y="115.70978429850003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Stripe</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 4432.248404081047 70.85080292850002 L 4551.177421097735 70.85080292850002 L 4551.177421097735 142.09742039850002 L 4432.248404081047 142.09742039850002 L 4432.248404081047 70.85080292850002 Z" stroke-miterlimit="10" stroke-width="4.222021776" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4460.878989249547" y="115.70978429850003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Webhook</text></g></g><g><g><rect fill="white" stroke="none" x="1112.2589578056777" y="194.8726925985" width="92.45454461417968" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1116.2171032206777" y="218.6215650885" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Click "Payer"</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 118.74436245000001 229.17661952850003 L 2194.9296432630354 229.17661952850003" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(2198.2280977755354,229.17661952850003) translate(-2198.2280977755354,-229.17661952850003)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2175.620395310602 219.09113128249294 L 2195.7560749158015 229.17661952850003 L 2175.620395310602 239.26210777450711" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="2263.2617193714727" y="268.75807367850007" width="228.7322545751172" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2267.219864786473" y="292.50694616850006" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">POST /api/payments/create-intent</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2198.2280977755354 303.06200060850006 L 2553.7291410300277 303.06200060850006" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(2557.0275955425277,303.06200060850006) translate(-2557.0275955425277,-303.06200060850006)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2534.419893077594 292.97651236249294 L 2554.555572682794 303.06200060850006 L 2534.419893077594 313.1474888545072" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="2588.2529649275275" y="342.64345475850007" width="202.65492303214845" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2592.2111103425277" y="366.39232724850007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">createPaymentIntent(req, res)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2557.0275955425277 376.94738168850006 L 2818.834802832176 376.94738168850006" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(2822.133257344676,376.94738168850006) translate(-2822.133257344676,-376.94738168850006)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2799.5255548797427 366.86189344249294 L 2819.6612344849423 376.94738168850006 L 2799.5255548797427 387.0328699345072" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="2868.8346475426642" y="416.5288358385001" width="190.44303948722657" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2872.7927929576645" y="440.27770832850007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">createIntent(orderId, userId)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2822.133257344676 450.83276276850006 L 3102.6806227153793 450.83276276850006" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(3105.9790772278793,450.83276276850006) translate(-3105.9790772278793,-450.83276276850006)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3083.371374762946 440.74727452249294 L 3103.5070543681454 450.83276276850006 L 3083.371374762946 460.9182510145072" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3171.3848436465705" y="490.4142169185" width="356.677765439375" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3175.3429890615707" y="514.1630894085" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">prisma.order.findUnique({ where: { id, customer_id } })</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3105.9790772278793 524.7181438485001 L 3590.169936250926 524.7181438485001" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(3593.468390763426,524.7181438485001) translate(-3593.468390763426,-524.7181438485001)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3570.8606882984927 514.6326556024931 L 3590.9963679036923 524.7181438485001 L 3570.8606882984927 534.8036320945071" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3656.9163553632698" y="564.2995979985001" width="410.3714910253125" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3660.87450077827" y="588.0484704885001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">SELECT * FROM orders WHERE id = ? AND customer_id = ?</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3593.468390763426 598.6035249285001 L 4127.437341217137 598.6035249285001" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(4130.735795729637,598.6035249285001) translate(-4130.735795729637,-598.6035249285001)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4108.128093264704 588.5180366824931 L 4128.263772869904 598.6035249285001 L 4108.128093264704 608.6890131745071" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3846.7337915815315" y="709.4315965485001" width="30.73660333" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3850.6919369965317" y="733.1804690385002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">null</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4130.735795729637 743.7355234785001 L 3596.7668452759262 743.7355234785001" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="10.555054440000001"/><g transform="translate(3593.468390763426,743.7355234785001) translate(-3593.468390763426,-743.7355234785001)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3616.0760932283597 733.6500352324931 L 3595.94041362316 743.7355234785001 L 3616.0760932283597 753.8210117245071" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3334.3554323306525" y="783.3169776285001" width="30.73660333" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3338.3135777456528" y="807.0658501185002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">null</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3593.468390763426 817.6209045585001 L 3109.2775317403793 817.6209045585001" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="10.555054440000001"/><g transform="translate(3105.9790772278793,817.6209045585001) translate(-3105.9790772278793,-817.6209045585001)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3128.586779692813 807.5354163124931 L 3108.451100087613 817.6209045585001 L 3128.586779692813 827.7063928045071" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="2892.882583028504" y="857.2023587085001" width="142.34716851554688" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2896.8407284435043" y="880.9512311985002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">OrderNotFoundError</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3105.9790772278793 891.5062856385001 L 2825.431711857176 891.5062856385001" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="10.555054440000001"/><g transform="translate(2822.133257344676,891.5062856385001) translate(-2822.133257344676,-891.5062856385001)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2844.7409598096096 881.4207973924931 L 2824.60528020441 891.5062856385001 L 2844.7409598096096 901.5917738845071" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="2457.7293375650274" y="931.0877397885001" width="104.90267999015624" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2461.6874829800277" y="954.8366122785002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">404 Not Found</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2822.133257344676 965.3916667185001 L 2201.5265522880354 965.3916667185001" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="10.555054440000001"/><g transform="translate(2198.2280977755354,965.3916667185001) translate(-2198.2280977755354,-965.3916667185001)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2220.835800240469 955.3061784724931 L 2200.7001206352693 965.3916667185001 L 2220.835800240469 975.4771549645071" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3823.1045877851448" y="1076.2197383385003" width="77.99501092277343" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3827.062733200145" y="1099.9686108285002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Order data</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4130.735795729637 1110.5236652685003 L 3596.7668452759262 1110.5236652685003" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="10.555054440000001"/><g transform="translate(3593.468390763426,1110.5236652685003) translate(-3593.468390763426,-1110.5236652685003)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3616.0760932283597 1100.4381770224932 L 3595.94041362316 1110.5236652685003 L 3616.0760932283597 1120.6091535145074" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3305.4327486148322" y="1150.1051194185004" width="88.58197076164062" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3309.3908940298325" y="1173.8539919085003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Order object</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3593.468390763426 1184.4090463485004 L 3109.2775317403793 1184.4090463485004" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="10.555054440000001"/><g transform="translate(3105.9790772278793,1184.4090463485004) translate(-3105.9790772278793,-1184.4090463485004)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3128.586779692813 1174.3235581024933 L 3108.451100087613 1184.4090463485004 L 3128.586779692813 1194.4945345945075" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3137.204446612879" y="1223.9905004985005" width="214.07223565421876" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3141.1625920278793" y="1247.7393729885005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">validateOrderCanBePaid(order)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3105.9790772278793 1258.2944274285005 L 3211.5296216278794 1258.2944274285005 L 3211.5296216278794 1292.5983543585005 L 3109.2775317403793 1292.5983543585005" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(3105.9790772278793,1292.5983543585005) translate(-3105.9790772278793,-1292.5983543585005)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3128.586779692813 1282.5128661124934 L 3108.451100087613 1292.5983543585005 L 3128.586779692813 1302.6838426045076" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="2886.769500142762" y="1403.4264259785007" width="154.57333428703126" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2890.727645557762" y="1427.1752984685006" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">OrderInvalidStateError</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3105.9790772278793 1437.7303529085007 L 2825.431711857176 1437.7303529085007" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="10.555054440000001"/><g transform="translate(2822.133257344676,1437.7303529085007) translate(-2822.133257344676,-1437.7303529085007)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2844.7409598096096 1427.6448646624935 L 2824.60528020441 1437.7303529085007 L 2844.7409598096096 1447.8158411545078" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="2449.5761622110235" y="1477.3118070585008" width="121.20903069816406" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2453.5343076260237" y="1501.0606795485007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">400 Bad Request</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2822.133257344676 1511.6157339885008 L 2201.5265522880354 1511.6157339885008" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="10.555054440000001"/><g transform="translate(2198.2280977755354,1511.6157339885008) translate(-2198.2280977755354,-1511.6157339885008)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2220.835800240469 1501.5302457424937 L 2200.7001206352693 1511.6157339885008 L 2220.835800240469 1521.701222234508" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3562.513996558869" y="1622.4438056085007" width="224.66638238273438" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3566.4721419738694" y="1646.1926780985007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">stripe.paymentIntents.create({...})</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3105.9790772278793 1656.7477325385007 L 4240.416843760094 1656.7477325385007" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(4243.715298272594,1656.7477325385007) translate(-4243.715298272594,-1656.7477325385007)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4221.107595807661 1646.6622442924936 L 4241.24327541286 1656.7477325385007 L 4221.107595807661 1666.8332207845078" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3561.6908001477364" y="1696.3291866885008" width="226.312775205" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3565.6489455627366" y="1720.0780591785008" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">PaymentIntent { id, client_secret }</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4243.715298272594 1730.6331136185008 L 3109.2775317403793 1730.6331136185008" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="10.555054440000001"/><g transform="translate(3105.9790772278793,1730.6331136185008) translate(-3105.9790772278793,-1730.6331136185008)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3128.586779692813 1720.5476253724937 L 3108.451100087613 1730.6331136185008 L 3128.586779692813 1740.718601864508" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3228.0168779483283" y="1770.214567768501" width="243.41371209464845" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3231.9750233633285" y="1793.963440258501" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">prisma.payment.create({ data: {...} })</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3105.9790772278793 1804.518494698501 L 3590.169936250926 1804.518494698501" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(3593.468390763426,1804.518494698501) translate(-3593.468390763426,-1804.518494698501)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3570.8606882984927 1794.4330064524938 L 3590.9963679036923 1804.518494698501 L 3570.8606882984927 1814.603982944508" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3638.4195978559455" y="1844.099948848501" width="447.36496026359373" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3642.3777432709458" y="1867.848821338501" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">INSERT INTO payments (order_id, stripe_intent_id, amount, status)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3593.468390763426 1878.403875778501 L 4127.437341217137 1878.403875778501" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(4130.735795729637,1878.403875778501) translate(-4130.735795729637,-1878.403875778501)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4108.128093264704 1868.318387532494 L 4128.263772869904 1878.403875778501 L 4108.128093264704 1888.4893640245082" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3802.7323725141487" y="1917.9853299285012" width="118.73944146476562" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3806.690517929149" y="1941.7342024185011" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Payment created</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4130.735795729637 1952.2892568585012 L 3596.7668452759262 1952.2892568585012" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="10.555054440000001"/><g transform="translate(3593.468390763426,1952.2892568585012) translate(-3593.468390763426,-1952.2892568585012)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3616.0760932283597 1942.203768612494 L 3595.94041362316 1952.2892568585012 L 3616.0760932283597 1962.3747451045083" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="2868.011443502137" y="1991.8707110085013" width="192.08944756828126" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2871.969588917137" y="2015.6195834985012" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">{ client_secret, payment_id }</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3105.9790772278793 2026.1746379385013 L 2825.431711857176 2026.1746379385013" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="10.555054440000001"/><g transform="translate(2822.133257344676,2026.1746379385013) translate(-2822.133257344676,-2026.1746379385013)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2844.7409598096096 2016.0891496924942 L 2824.60528020441 2026.1746379385013 L 2844.7409598096096 2036.2601261845084" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="2422.893995157801" y="2065.756092088501" width="174.57336480460938" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2426.852140572801" y="2089.504964578501" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">200 OK + { client_secret }</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2822.133257344676 2100.0600190185014 L 2201.5265522880354 2100.0600190185014" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="10.555054440000001"/><g transform="translate(2198.2280977755354,2100.0600190185014) translate(-2198.2280977755354,-2100.0600190185014)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2220.835800240469 2089.9745307724943 L 2200.7001206352693 2100.0600190185014 L 2220.835800240469 2110.1455072645085" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="2229.453467160535" y="2139.6414731685013" width="318.3384404882031" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2233.4116125755354" y="2163.3903456585012" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">stripe.confirmCardPayment(clientSecret, {card})</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2198.2280977755354 2173.945400098501 L 2303.7786421755354 2173.945400098501 L 2303.7786421755354 2208.2493270285013 L 2201.5265522880354 2208.2493270285013" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(2198.2280977755354,2208.2493270285013) translate(-2198.2280977755354,-2208.2493270285013)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2220.835800240469 2198.163838782494 L 2200.7001206352693 2208.2493270285013 L 2220.835800240469 2218.3348152745084" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="1091.3820886040176" y="2326.993689478501" width="134.2082830175" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1095.3402340190175" y="2350.742561968501" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Saisit numéro carte</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 118.74436245000001 2361.297616408501 L 2194.9296432630354 2361.297616408501" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(2198.2280977755354,2361.297616408501) translate(-2198.2280977755354,-2361.297616408501)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2175.620395310602 2351.212128162494 L 2195.7560749158015 2361.297616408501 L 2175.620395310602 2371.3831046545083" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3041.4266538053535" y="2400.879070558501" width="359.09008843742185" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3045.3847992203537" y="2424.627943048501" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">confirmCardPayment(client_secret, payment_method)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2198.2280977755354 2435.1829974885013 L 4240.416843760094 2435.1829974885013" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(4243.715298272594,2435.1829974885013) translate(-4243.715298272594,-2435.1829974885013)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4221.107595807661 2425.097509242494 L 4241.24327541286 2435.1829974885013 L 4221.107595807661 2445.2684857345084" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3121.3121060758613" y="2546.011069108501" width="199.31918389640626" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3125.2702514908615" y="2569.759941598501" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Error { code: 'card_declined' }</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4243.715298272594 2580.3149960385012 L 2201.5265522880354 2580.3149960385012" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="10.555054440000001"/><g transform="translate(2198.2280977755354,2580.3149960385012) translate(-2198.2280977755354,-2580.3149960385012)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2220.835800240469 2570.229507792494 L 2200.7001206352693 2580.3149960385012 L 2220.835800240469 2590.4004842845084" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="1097.72067350392" y="2619.896450188501" width="121.5311132176953" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1101.67881891892" y="2643.645322678501" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Message d'erreur</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2198.2280977755354 2654.2003771185014 L 122.04281696250001 2654.2003771185014" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="10.555054440000001"/><g transform="translate(118.74436245000001,2654.2003771185014) translate(-118.74436245000001,-2654.2003771185014)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 141.35206491493346 2644.1148888724942 L 121.21638530973378 2654.2003771185014 L 141.35206491493346 2664.2858653645085" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3096.859698238947" y="2765.028448738501" width="248.22399957023438" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3100.8178436539474" y="2788.777321228501" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">PaymentIntent { status: 'succeeded' }</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4243.715298272594 2799.3323756685013 L 2201.5265522880354 2799.3323756685013" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="10.555054440000001"/><g transform="translate(2198.2280977755354,2799.3323756685013) translate(-2198.2280977755354,-2799.3323756685013)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2220.835800240469 2789.246887422494 L 2200.7001206352693 2799.3323756685013 L 2220.835800240469 2809.4178639145084" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="1082.097901287123" y="2838.913829818501" width="152.77665765128907" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1086.056046702123" y="2862.662702308501" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">"Paiement en cours..."</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2198.2280977755354 2873.2177567485014 L 122.04281696250001 2873.2177567485014" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="10.555054440000001"/><g transform="translate(118.74436245000001,2873.2177567485014) translate(-118.74436245000001,-2873.2177567485014)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 141.35206491493346 2863.1322685024943 L 121.21638530973378 2873.2177567485014 L 141.35206491493346 2883.3032449945085" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="4274.940667657594" y="2952.380665048501" width="185.54687554679688" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4278.898813072594" y="2976.129537538501" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">POST /api/webhooks/stripe</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4243.715298272594 2986.6845919785014 L 4488.414458076891 2986.6845919785014" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(4491.712912589391,2986.6845919785014) translate(-4491.712912589391,-2986.6845919785014)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4469.105210124458 2976.5991037324943 L 4489.240889729657 2986.6845919785014 L 4469.105210124458 2996.7700802245085" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="4522.9382819743905" y="3026.2660461285013" width="198.3170476659375" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4526.896427389391" y="3050.0149186185013" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">verifyWebhookSignature(req)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4491.712912589391 3060.569973058501 L 4597.263456989391 3060.569973058501 L 4597.263456989391 3094.8738999885013 L 4495.011367101891 3094.8738999885013" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(4491.712912589391,3094.8738999885013) translate(-4491.712912589391,-3094.8738999885013)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4514.320615054324 3084.788411742494 L 4494.184935449124 3094.8738999885013 L 4514.320615054324 3104.9593882345084" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="4307.10959008191" y="3205.701971608501" width="121.20903069816406" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4311.06773549691" y="3229.450844098501" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">400 Bad Request</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4491.712912589391 3240.0058985385012 L 4247.013752785094 3240.0058985385012" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="10.555054440000001"/><g transform="translate(4243.715298272594,3240.0058985385012) translate(-4243.715298272594,-3240.0058985385012)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4266.323000737527 3229.920410292494 L 4246.187321132327 3240.0058985385012 L 4266.323000737527 3250.0913867845084" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="4522.9382819743905" y="3350.833970158501" width="165.99066216789063" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4526.896427389391" y="3374.582842648501" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">extractEventData(event)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4491.712912589391 3385.1378970885007 L 4597.263456989391 3385.1378970885007 L 4597.263456989391 3419.441824018501 L 4495.011367101891 3419.441824018501" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(4491.712912589391,3419.441824018501) translate(-4491.712912589391,-3419.441824018501)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4514.320615054324 3409.356335772494 L 4494.184935449124 3419.441824018501 L 4514.320615054324 3429.527312264508" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3658.7998673159004" y="3530.2698956385007" width="280.09225518546873" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3662.7580127309006" y="3554.0187681285006" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">handlePaymentSuccess(paymentIntentId)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4491.712912589391 3564.573822568501 L 3109.2775317403793 3564.573822568501" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(3105.9790772278793,3564.573822568501) translate(-3105.9790772278793,-3564.573822568501)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3128.586779692813 3554.4883343224938 L 3108.451100087613 3564.573822568501 L 3128.586779692813 3574.659310814508" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3159.967515765711" y="3604.1552767185008" width="379.51242120109373" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3163.9256611807114" y="3627.9041492085007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">prisma.payment.findUnique({ where: { stripe_intent_id } })</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3105.9790772278793 3638.459203648501 L 3590.169936250926 3638.459203648501" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(3593.468390763426,3638.459203648501) translate(-3593.468390763426,-3638.459203648501)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3570.8606882984927 3628.373715402494 L 3590.9963679036923 3638.459203648501 L 3570.8606882984927 3648.544691894508" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3673.809696427723" y="3678.040657798501" width="376.58480889640623" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3677.767841842723" y="3701.789530288501" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">SELECT * FROM payments WHERE stripe_intent_id = ?</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3593.468390763426 3712.344584728501 L 4127.437341217137 3712.344584728501" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(4130.735795729637,3712.344584728501) translate(-4130.735795729637,-3712.344584728501)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4108.128093264704 3702.259096482494 L 4128.263772869904 3712.344584728501 L 4108.128093264704 3722.430072974508" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3812.9148981489143" y="3751.926038878501" width="98.37439019523437" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3816.8730435639145" y="3775.674911368501" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Payment data</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4130.735795729637 3786.229965808501 L 3596.7668452759262 3786.229965808501" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="10.555054440000001"/><g transform="translate(3593.468390763426,3786.229965808501) translate(-3593.468390763426,-3786.229965808501)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3616.0760932283597 3776.144477562494 L 3595.94041362316 3786.229965808501 L 3616.0760932283597 3796.3154540545083" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3295.2430589786018" y="3825.811419958501" width="108.96135003410156" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3299.201204393602" y="3849.560292448501" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Payment object</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3593.468390763426 3860.1153468885013 L 3109.2775317403793 3860.1153468885013" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="10.555054440000001"/><g transform="translate(3105.9790772278793,3860.1153468885013) translate(-3105.9790772278793,-3860.1153468885013)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3128.586779692813 3850.029858642494 L 3108.451100087613 3860.1153468885013 L 3128.586779692813 3870.2008351345085" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3266.7391450992072" y="3899.6968010385012" width="165.96917779289063" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3270.6972905142075" y="3923.445673528501" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">prisma.$transaction([...])</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3105.9790772278793 3934.0007279685015 L 3590.169936250926 3934.0007279685015" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(3593.468390763426,3934.0007279685015) translate(-3593.468390763426,-3934.0007279685015)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3570.8606882984927 3923.9152397224943 L 3590.9963679036923 3934.0007279685015 L 3570.8606882984927 3944.0862162145086" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3641.21843361034" y="3973.5821821185014" width="441.7672734960156" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3645.1765790253403" y="3997.3310546085013" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">UPDATE payments SET status = 'COMPLETED', paid_at = NOW()</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3593.468390763426 4007.8861090485016 L 4127.437341217137 4007.8861090485016" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(4130.735795729637,4007.8861090485016) translate(-4130.735795729637,-4007.8861090485016)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4108.128093264704 3997.8006208024944 L 4128.263772869904 4007.8861090485016 L 4108.128093264704 4017.9715972945087" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3624.693760148426" y="4047.4675631985015" width="474.816681455" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3628.651905563426" y="4071.2164356885014" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">UPDATE orders SET status = 'PROCESSING', payment_status = 'PAID'</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3593.468390763426 4081.7714901285017 L 4127.437341217137 4081.7714901285017" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(4130.735795729637,4081.7714901285017) translate(-4130.735795729637,-4081.7714901285017)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4108.128093264704 4071.6860018824946 L 4128.263772869904 4081.7714901285017 L 4108.128093264704 4091.856978374509" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3679.6543772138557" y="4121.352944278502" width="364.8954473241406" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3683.612522628856" y="4145.101816768502" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">UPDATE customers SET last_purchase_date = NOW()</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3593.468390763426 4155.656871208502 L 4127.437341217137 4155.656871208502" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(4130.735795729637,4155.656871208502) translate(-4130.735795729637,-4155.656871208502)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4108.128093264704 4145.571382962495 L 4128.263772869904 4155.656871208502 L 4108.128093264704 4165.742359454509" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3137.204446612879" y="4195.238325358501" width="203.45663506828126" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3141.1625920278793" y="4218.987197848502" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">sendConfirmationEmail(order)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3105.9790772278793 4229.542252288502 L 3211.5296216278794 4229.542252288502 L 3211.5296216278794 4263.846179218502 L 3109.2775317403793 4263.846179218502" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(3105.9790772278793,4263.846179218502) translate(-3105.9790772278793,-4263.846179218502)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3128.586779692813 4253.760690972495 L 3108.451100087613 4263.846179218502 L 3128.586779692813 4273.931667464509" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3137.204446612879" y="4303.427633368501" width="139.09730584464845" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3141.1625920278793" y="4327.1765058585015" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">createInvoice(order)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3105.9790772278793 4337.731560298502 L 3211.5296216278794 4337.731560298502 L 3211.5296216278794 4372.035487228502 L 3109.2775317403793 4372.035487228502" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(3105.9790772278793,4372.035487228502) translate(-3105.9790772278793,-4372.035487228502)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3128.586779692813 4361.949998982494 L 3108.451100087613 4372.035487228502 L 3128.586779692813 4382.120975474509" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3767.185647650373" y="4411.616941378502" width="63.32069451652344" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3771.1437930653733" y="4435.365813868502" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Success</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3105.9790772278793 4445.920868308502 L 4488.414458076891 4445.920868308502" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="10.555054440000001"/><g transform="translate(4491.712912589391,4445.920868308502) translate(-4491.712912589391,-4445.920868308502)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4469.105210124458 4435.835380062495 L 4489.240889729657 4445.920868308502 L 4469.105210124458 4456.006356554509" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="4338.899125604371" y="4485.502322458502" width="57.62995965324219" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4342.857271019371" y="4509.251194948502" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">200 OK</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4491.712912589391 4519.806249388502 L 4247.013752785094 4519.806249388502" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="10.555054440000001"/><g transform="translate(4243.715298272594,4519.806249388502) translate(-4243.715298272594,-4519.806249388502)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4266.323000737527 4509.720761142495 L 4246.187321132327 4519.806249388502 L 4266.323000737527 4529.891737634509" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3664.096925421369" y="4630.634321008502" width="269.49813897453123" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3668.0550708363694" y="4654.383193498503" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">handlePaymentFailure(paymentIntentId)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4491.712912589391 4664.938247938502 L 3109.2775317403793 4664.938247938502" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(3105.9790772278793,4664.938247938502) translate(-3105.9790772278793,-4664.938247938502)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3128.586779692813 4654.852759692495 L 3108.451100087613 4664.938247938502 L 3128.586779692813 4675.023736184509" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3137.204446612879" y="4704.5197020885025" width="425.03854424796873" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3141.1625920278793" y="4728.268574578503" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">prisma.payment.update({ where: {...}, data: { status: 'FAILED' } })</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3105.9790772278793 4738.823629018502 L 3590.169936250926 4738.823629018502" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(3593.468390763426,4738.823629018502) translate(-3593.468390763426,-4738.823629018502)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3570.8606882984927 4728.738140772495 L 3590.9963679036923 4738.823629018502 L 3570.8606882984927 4748.909117264509" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3720.846203080555" y="4778.405083168503" width="282.5117803319531" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3724.804348495555" y="4802.153955658503" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">UPDATE payments SET status = 'FAILED'</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3593.468390763426 4812.709010098502 L 4127.437341217137 4812.709010098502" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(4130.735795729637,4812.709010098502) translate(-4130.735795729637,-4812.709010098502)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4108.128093264704 4802.623521852495 L 4128.263772869904 4812.709010098502 L 4108.128093264704 4822.7944983445095" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3137.204446612879" y="4852.290464248502" width="210.77232415519532" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3141.1625920278793" y="4876.039336738502" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">notifyCustomerOfFailure(order)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3105.9790772278793 4886.5943911785025 L 3211.5296216278794 4886.5943911785025 L 3211.5296216278794 4920.898318108502 L 3109.2775317403793 4920.898318108502" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(3105.9790772278793,4920.898318108502) translate(-3105.9790772278793,-4920.898318108502)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3128.586779692813 4910.812829862495 L 3108.451100087613 4920.898318108502 L 3128.586779692813 4930.983806354509" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3767.185647650373" y="4960.479772258503" width="63.32069451652344" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3771.1437930653733" y="4984.228644748503" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Success</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3105.9790772278793 4994.783699188502 L 4488.414458076891 4994.783699188502" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="10.555054440000001"/><g transform="translate(4491.712912589391,4994.783699188502) translate(-4491.712912589391,-4994.783699188502)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4469.105210124458 4984.698210942495 L 4489.240889729657 4994.783699188502 L 4469.105210124458 5004.8691874345095" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="4338.899125604371" y="5034.365153338503" width="57.62995965324219" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4342.857271019371" y="5058.114025828503" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">200 OK</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4491.712912589391 5068.6690802685025 L 4247.013752785094 5068.6690802685025" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="10.555054440000001"/><g transform="translate(4243.715298272594,5068.6690802685025) translate(-4243.715298272594,-5068.6690802685025)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4266.323000737527 5058.583592022495 L 4246.187321132327 5068.6690802685025 L 4266.323000737527 5078.75456851451" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="2255.5201345936407" y="5187.413442718504" width="244.21542413078126" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2259.478280008641" y="5211.162315208504" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">GET /api/orders/123/payment-status</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2198.2280977755354 5221.717369648503 L 2553.7291410300277 5221.717369648503" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(2557.0275955425277,5221.717369648503) translate(-2557.0275955425277,-5221.717369648503)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2534.419893077594 5211.631881402496 L 2554.555572682794 5221.717369648503 L 2534.419893077594 5231.80285789451" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="2595.9945497053595" y="5261.298823798504" width="187.17175347648438" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2599.9526951203597" y="5285.047696288504" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">getPaymentStatus(req, res)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2557.0275955425277 5295.602750728503 L 2818.834802832176 5295.602750728503" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(2822.133257344676,5295.602750728503) translate(-2822.133257344676,-5295.602750728503)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2799.5255548797427 5285.517262482496 L 2819.6612344849423 5295.602750728503 L 2799.5255548797427 5305.688238974511" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="2853.358626729676" y="5335.184204878504" width="221.39508111320313" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2857.316772144676" y="5358.933077368504" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">getOrderPaymentStatus(orderId)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2822.133257344676 5369.488131808504 L 3102.6806227153793 5369.488131808504" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(3105.9790772278793,5369.488131808504) translate(-3105.9790772278793,-5369.488131808504)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3083.371374762946 5359.402643562496 L 3103.5070543681454 5369.488131808504 L 3083.371374762946 5379.573620054511" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3146.9252870669807" y="5409.069585958504" width="405.59689385734373" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3150.883432481981" y="5432.818458448504" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">prisma.order.findUnique({ where: { id }, include: { payment } })</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3105.9790772278793 5443.373512888504 L 3590.169936250926 5443.373512888504" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(3593.468390763426,5443.373512888504) translate(-3593.468390763426,-5443.373512888504)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3570.8606882984927 5433.288024642497 L 3590.9963679036923 5443.373512888504 L 3570.8606882984927 5453.459001134511" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3657.9328119672737" y="5482.954967038504" width="408.33859307609373" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3661.890957382274" y="5506.703839528504" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">SELECT * FROM orders o JOIN payments p WHERE o.id = ?</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3593.468390763426 5517.258893968504 L 4127.437341217137 5517.258893968504" stroke-miterlimit="10" stroke-width="2.1989696750000003"/><g transform="translate(4130.735795729637,5517.258893968504) translate(-4130.735795729637,-5517.258893968504)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4108.128093264704 5507.173405722497 L 4128.263772869904 5517.258893968504 L 4108.128093264704 5527.344382214511" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3794.1854822553596" y="5556.840348118504" width="135.83322198234376" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3798.14362767036" y="5580.589220608505" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Order with payment</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 4130.735795729637 5591.144275048504 L 3596.7668452759262 5591.144275048504" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="10.555054440000001"/><g transform="translate(3593.468390763426,5591.144275048504) translate(-3593.468390763426,-5591.144275048504)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3616.0760932283597 5581.058786802497 L 3595.94041362316 5591.144275048504 L 3616.0760932283597 5601.229763294511" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="3310.726228534266" y="5630.725729198504" width="77.99501092277343" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3314.684373949266" y="5654.474601688505" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Order data</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3593.468390763426 5665.029656128504 L 3109.2775317403793 5665.029656128504" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="10.555054440000001"/><g transform="translate(3105.9790772278793,5665.029656128504) translate(-3105.9790772278793,-5665.029656128504)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3128.586779692813 5654.944167882497 L 3108.451100087613 5665.029656128504 L 3128.586779692813 5675.115144374511" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="2909.579070455262" y="5704.611110278504" width="108.95419366203124" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2913.537215870262" y="5728.359982768505" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Payment status</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3105.9790772278793 5738.915037208504 L 2825.431711857176 5738.915037208504" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="10.555054440000001"/><g transform="translate(2822.133257344676,5738.915037208504) translate(-2822.133257344676,-5738.915037208504)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2844.7409598096096 5728.829548962497 L 2824.60528020441 5738.915037208504 L 2844.7409598096096 5749.000525454511" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="2391.9992121377813" y="5778.4964913585045" width="236.36293084464845" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2395.9573575527816" y="5802.245363848505" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">200 OK + { status: 'COMPLETED' }</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2822.133257344676 5812.800418288504 L 2201.5265522880354 5812.800418288504" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="10.555054440000001"/><g transform="translate(2198.2280977755354,5812.800418288504) translate(-2198.2280977755354,-5812.800418288504)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2220.835800240469 5802.714930042497 L 2200.7001206352693 5812.800418288504 L 2220.835800240469 5822.885906534511" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><rect fill="white" stroke="none" x="1074.077134075209" y="5852.381872438505" width="168.8181920751172" height="34.30392693"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1078.035279490209" y="5876.130744928505" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">"Paiement confirmé! 🎉"</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2198.2280977755354 5886.685799368504 L 122.04281696250001 5886.685799368504" stroke-miterlimit="10" stroke-width="2.1989696750000003" stroke-dasharray="10.555054440000001"/><g transform="translate(118.74436245000001,5886.685799368504) translate(-118.74436245000001,-5886.685799368504)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 141.35206491493346 5876.600311122497 L 121.21638530973378 5886.685799368504 L 141.35206491493346 5896.7712876145115" stroke-miterlimit="10" stroke-width="2.1989696750000003"/></g></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2079.4837353255352 638.1849790785001 L 4362.459660722594 638.1849790785001 L 4362.459660722594 2287.412235328501 L 2079.4837353255352 2287.412235328501 L 2079.4837353255352 638.1849790785001 Z" stroke-miterlimit="10" stroke-width="3.7696623000000002" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 2079.4837353255352 638.1849790785001 L 2079.4837353255352 669.8501423985001 L 2145.9478045226056 669.8501423985001 L 2161.7803861826055 654.0175607385 L 2161.7803861826055 638.1849790785001 L 2079.4837353255352 638.1849790785001" stroke-miterlimit="10" stroke-width="3.7696623000000002"/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="2105.871371425535" y="659.2950879585001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><g><rect fill="white" stroke="none" x="2184.209876867605" y="640.2959899665001" width="247.74528558097657" height="27.443141544000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="2188.1680222826053" y="659.2950879585001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Commande non trouvée ou non autorisée]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2079.4837353255352 1004.9731208685001 L 4362.459660722594 1004.9731208685001" stroke-miterlimit="10" stroke-width="3.7696623000000002" stroke-dasharray="6.596909025"/></g><g/><g><rect fill="white" stroke="none" x="2184.209876867605" y="1007.0841317565001" width="116.11512811027343" height="27.443141544000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="2188.1680222826053" y="1026.0832297485001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Commande valide]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2105.8713714255355 1332.1798085085006 L 4336.072024622594 1332.1798085085006 L 4336.072024622594 2247.830781178501 L 2105.8713714255355 2247.830781178501 L 2105.8713714255355 1332.1798085085006 Z" stroke-miterlimit="10" stroke-width="3.7696623000000002" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 2105.8713714255355 1332.1798085085006 L 2105.8713714255355 1363.8449718285005 L 2172.335440622606 1363.8449718285005 L 2188.1680222826058 1348.0123901685006 L 2188.1680222826058 1332.1798085085006 L 2105.8713714255355 1332.1798085085006" stroke-miterlimit="10" stroke-width="3.7696623000000002"/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="2132.2590075255353" y="1353.2899173885005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><g><rect fill="white" stroke="none" x="2210.5975129676053" y="1334.2908193965004" width="141.55108697257813" height="27.443141544000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="2214.5556583826055" y="1353.2899173885005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Déjà payée ou invalide]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2105.8713714255355 1551.197188138501 L 4336.072024622594 1551.197188138501" stroke-miterlimit="10" stroke-width="3.7696623000000002" stroke-dasharray="6.596909025"/></g><g/><g><rect fill="white" stroke="none" x="2210.5975129676053" y="1553.3081990265007" width="117.39807183585937" height="27.443141544000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="2214.5556583826055" y="1572.3072970185008" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[OK pour paiement]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 26.38763610000001 2474.764451638501 L 4336.072024622594 2474.764451638501 L 4336.072024622594 2912.7992108985013 L 26.38763610000001 2912.7992108985013 L 26.38763610000001 2474.764451638501 Z" stroke-miterlimit="10" stroke-width="3.7696623000000002" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 26.38763610000001 2474.764451638501 L 26.38763610000001 2506.429614958501 L 92.85170529707032 2506.429614958501 L 108.68428695707033 2490.597033298501 L 108.68428695707033 2474.764451638501 L 26.38763610000001 2474.764451638501" stroke-miterlimit="10" stroke-width="3.7696623000000002"/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="52.77527220000001" y="2495.8745605185013" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><g><rect fill="white" stroke="none" x="131.11377764207035" y="2476.8754625265015" width="90.70777947746093" height="27.443141544000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="135.07192305707034" y="2495.8745605185013" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Carte refusée]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 26.38763610000001 2693.7818312685013 L 4336.072024622594 2693.7818312685013" stroke-miterlimit="10" stroke-width="3.7696623000000002" stroke-dasharray="6.596909025"/></g><g/><g><rect fill="white" stroke="none" x="131.11377764207035" y="2695.8928421565015" width="105.70245416007812" height="27.443141544000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="135.07192305707034" y="2714.8919401485014" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Paiement réussi]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2987.234714777879 3134.455354138501 L 4698.1646167772815 3134.455354138501 L 4698.1646167772815 5147.831988568503 L 2987.234714777879 5147.831988568503 L 2987.234714777879 3134.455354138501 Z" stroke-miterlimit="10" stroke-width="3.7696623000000002" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 2987.234714777879 3134.455354138501 L 2987.234714777879 3166.120517458501 L 3053.6987839749495 3166.120517458501 L 3069.5313656349495 3150.287935798501 L 3069.5313656349495 3134.455354138501 L 2987.234714777879 3134.455354138501" stroke-miterlimit="10" stroke-width="3.7696623000000002"/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="3013.622350877879" y="3155.5654630185013" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><g><rect fill="white" stroke="none" x="3091.960856319949" y="3136.5663650265014" width="116.76229913078124" height="27.443141544000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="3095.9190017349492" y="3155.5654630185013" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Signature invalide]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2987.234714777879 3279.587352688501 L 4698.1646167772815 3279.587352688501" stroke-miterlimit="10" stroke-width="3.7696623000000002" stroke-dasharray="6.596909025"/></g><g/><g><rect fill="white" stroke="none" x="3091.960856319949" y="3281.6983635765014" width="106.33819634757812" height="27.443141544000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="3095.9190017349492" y="3300.6974615685012" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Signature valide]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3013.6223508778794 3459.023278168501 L 4584.069638939391 3459.023278168501 L 4584.069638939391 5108.250534418503 L 3013.6223508778794 5108.250534418503 L 3013.6223508778794 3459.023278168501 Z" stroke-miterlimit="10" stroke-width="3.7696623000000002" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 3013.6223508778794 3459.023278168501 L 3013.6223508778794 3490.6884414885008 L 3080.0864200749497 3490.6884414885008 L 3095.9190017349497 3474.855859828501 L 3095.9190017349497 3459.023278168501 L 3013.6223508778794 3459.023278168501" stroke-miterlimit="10" stroke-width="3.7696623000000002"/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="3040.009986977879" y="3480.133387048501" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><g><rect fill="white" stroke="none" x="3118.3484924199493" y="3461.134289056501" width="232.7964635594922" height="27.443141544000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="3122.3066378349495" y="3480.133387048501" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Event type: payment_intent.succeeded]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 3013.6223508778794 4559.387703538502 L 4584.069638939391 4559.387703538502" stroke-miterlimit="10" stroke-width="3.7696623000000002" stroke-dasharray="6.596909025"/></g><g/><g><rect fill="white" stroke="none" x="3118.3484924199493" y="4561.4987144265015" width="257.55656487785154" height="27.443141544000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="3122.3066378349495" y="4580.497812418502" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Event type: payment_intent.payment_failed]</text></g><g/></g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></g></svg>